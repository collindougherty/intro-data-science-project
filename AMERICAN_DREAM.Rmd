---
title: "The American Dream: A Promise of Upward Mobility"
author: "Akbota Atibayeva, Collin Dougherty, Fidel Nkwocha, Panawe Mewenemesse, Jerry Gallagher"
output: pdf_document
date: "2023-04-02"
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

\section{Introduction}
\subsection{Background}
The American Dream is an idea that has been embedded in the American psyche for decades. It is a concept that has been held up as a beacon of hope and a promise of a better future for generations of Americans. At its core, the American Dream is the belief that anyone, regardless of their background or social status, can achieve success and prosperity through hard work and determination. The American Dream has its roots in the early days of American history, when immigrants came to the United States seeking religious freedom and economic opportunity. The idea of the "land of opportunity" and the promise of a better future for oneself and one's family has been a driving force for generations of immigrants who have come to America in search of a better life. The concept has been depicted in literature, art, and film, and has been the inspiration for millions of people who have come to the United States in search of a better life. Although immigrants are a minority in the United States, the truth is that  the majority of the population are the descendants of immigrants who came to the United States seeking the American Dream.

\subsection{Motivation}
For some people, the American Dream is synonymous with **upward mobility – the idea that one can start at the bottom and work their way up to the top**. We are motivated to study the extent to which the American population experiences upward mobility.  As we analyze publicly available dataset, we expect to see some periods of upward and downward trends in mobility. An upward trend would happen when an individual moves from a lower to a higher socioeconomic status, and a downward trend would happen when an individual moves from a higher socioeconomic status to a lower one.  While upward mobility is often seen as desirable, downward mobility can be a significant challenge, as it can lead to a loss of income, status, and opportunities. However, it is important to note that both upward and downward mobility are natural and inevitable aspects of social mobility.

Investopedia [^8] defines the American Dream as “...  the belief that anyone, regardless of where they were born or what class they were born into, can attain their own version of success in a society in which upward mobility is possible for everyone. The American dream is believed to be achieved through sacrifice, risk-taking, and hard work, rather than by chance.” It was popularized in the 1930s by historian James Truslow Adams, who defined it as "that dream of a land in which life should be better and richer and fuller for everyone, with opportunity for each according to ability or achievement."  However, there are some differing opinions today on the American Dream.  Is it an illusion? Or is it a reality? By analyzing trends and data, we would let the data help guide the opinions on this subject. 

Exploring the American Dream and upward mobility is important for a few reasons:
Understanding social mobility: Exploring the concept of upward mobility helps us understand how social mobility works in society. It allows us to examine the factors that contribute to success, including education, hard work, and access to resources.
Encouraging aspiration: Examining the American Dream and upward mobility can also inspire people to pursue their goals and dreams. By seeing examples of success and learning about the factors that contribute to it, people can be encouraged to work hard and strive for their own upward mobility.

For some people, the American Dream could mean achieving financial success, owning a home, or attaining a certain level of social status. However, there are others who see the American Dream as more than just material success; they view it as the ability to live a fulfilling life, to pursue their passions and dreams, and to have a sense of purpose and meaning in life. 


\subsection{Research question (s)}
By the end of this research paper, we plan to shed some light on the following questions:
\begin{enumerate}
\item How has the upward mobility among diverse populations in the United States changed from 2000 to 2021? 
  \begin{itemize}
    \item Are Americans attaining wealth?
    \item Are Americans achieving the dream of home ownership?
  \end{itemize}
\item Are immigrants still seeking entry into America? 
\end{enumerate}


\section{Data}
\subsection{Data Background and Sources}
In this research, we will borrow the majority of our data from the United States Census Bureau.  The census.gov website provides us with several decades of data for the American population.  The federal reserve as well as the bureau of economic analysis data repositories also provide us with many years income and wealth data. 

We will use the datasets for wealth [^1][^2][^9][^10][^11] to see the median assets of Americans.  This data includes information for net worth, assets at financial institutions (i.e., checking account and other interest-earning accounts), stocks and mutual fund shares, equity in business or profession, equity in own home, equity in motor vehicles, equity in rental properties, equity in other real estate, retirement accounts (i.e., IRA and 401(k)), educational savings accounts, annuities/Trusts, cash value life insurance, and other assets. There is a separate Excel file for each year on wealth data.  And each wealth Excel file has several tabs. The data is provided for the general population and broken down by demographics (i.e., race, age groups, education, and household size. The Census Bureau also provides us with a state-by-state breakdown of the same wealth data [^3]. And just like nation-wide wealth data, the state data is provided in a separate Excel file for each year.  From another Census Bureau dataset, we obtained household income data for the general population and by race for years 1967 through 2021 [^4]. In this dataset, we see the percent distribution for different income ranges, the median income, and mean income for each year. 

For immigration data, we will borrow from three different datasets.  The first dataset provides us data for annual inmigration, outmigration, net migration, and movers from abroad by regions (northeast, midwest, west, and south : 1981-2021 [^5]. The second immigration dataset informs us of how many visas the United States government issued to foreigners [^6].  The visas dataset includes all nonimmigrant visas issued, including temporary visitors coming for work, school, or tourism. Visas vary in duration depending on the reason they are issued. Lawful permanent residents, also known as "green card" holders, are excluded from the visas dataset.  And finally, we have another dataset for asylum claims granted by the U.S government  [^7]. Usually, an individual would seek asylum when he or she is unable or unwilling to return to his or her home country due to persecution or a well-founded fear of persecution due to race, religion, nationality, membership in a particular social group, or political opinion. Asylum seekers apply either at a United States port of entry or from within the US.

\subsection{Brief description of data}
Census data provides valuable information about various demographic and socioeconomic factors of a population, including wealth, home ownership, income, and migration. Within the datasets contained at census.gov we used a subset including: wealth, home ownership, income, and migration. 

\section{Exploratory Data Analysis}
\subsection{Data Cleaning}
Since some of the Excel files we used have multiple tabs (spreadsheets), multiple header columns, and random notes embedded across multiple columns, we found it necessary to clean and reorganize some of the datasets.

Cleaning of income data (tableA2.csv) has comprised several steps. Besides manual cleaning of the data, it has been explored for NAs, then they have been omitted. In general, the data was filtered, selected reshaped (melted) and merged (full_join) to efficiently produce visualizations.The class of certain columns were changed to numeric or to factor. Some of the column names were renamed. 

The data sets 'home' and 'home_price' were basically clean. However, the most challenging part in working with those data was changing class type from character to date. Since usual codes did not work, other approaches were implemented and data were successfully visualized.   

\subsection{Data Summary}

The immigration dataset 'hst_mig_a_2.csv' arranged the data in segments of year ranges and regions.  One single column, named "Mobility Period and Type of Migration," was used to show both the year ranges and the regions.  We had to separate the two into their own individual columns and named the modified dataset as 'hst_mig_a_2_ReOrganized.csv'.

The visas dataset visas_granted_usafacts.csv arranged the data in a wide fashion, with the row names at the far left column.  We selected the first row named "Years" and the second row named "Visas granted (People)."  We transposed the first and second rows into two columns named "Years" and "Visas".

The asylums dataset 'asylum_claims_granted_usafacts.csv' arranged the data in a wide fashion, with the row names at the far left column, just like what we saw in the visas dataset. We selected the first row named "Years" and the second row named "Asylum claims granted (People)." We transposed the first and second rows into two columns named "Years" and "Asylums".

The walth data was in several different file types spread accross the years. The most recent data was in xlsx so it ws desided to standardize on that format. Only the necessary data was kept from the wealth data. Names were standardized and inconcistancies among the files was correected. NAs were added where the data didn't exist to fill out the data sets. Irrelevant data was removed to only have the data for the period of interest for the paper. 


\subsection{Findings and Explanations}

```{r, load-packages, setup, include=FALSE}
rm(list = ls(all.names = TRUE))
cat("\014")
library(data.table)
library(GGally)
library(gganimate)
library(ggeasy)
library(ggplot2)
library(grid)
library(gridExtra)
library(janitor)
library(kableExtra)
library(knitr)
library(mdsr)
library(naniar)
library(patchwork)
library(readxl)
library(skimr)
library(stats)
library(stringr)
library(tidyr)
library(transformr)
library(usmap)
library(zoo)
options(scipen = 999)
suppressMessages(library(tidyverse))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(reshape2))
suppressPackageStartupMessages(library(scales))
opts_chunk$set(fig.align='center', message=FALSE, warning=FALSE)
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
income = fread('tableA2.csv')
income$Number_thousands = as.numeric(income$Number_thousands)
income$Median_income = as.numeric(income$Median_income)
income$Margin_of_error_for_median = as.numeric(income$Margin_of_error_for_median)
income$Mean_income = as.numeric(income$Mean_income)
income$Margin_of_error_for_mean = as.numeric(income$Margin_of_error_for_mean)
i= income %>% 
  select(-Margin_of_error_for_median, -Margin_of_error_for_mean) %>% 
  na.omit()  
#skim (i)
```


\subsection{Results and Discussion}

Since one of the measures of upward mobility is healthy economy and in turn economic advancement is highly dependent on job advancement, real median household income of different races over time has been demonstrated in Figure 1. Real income has been adjusted for inflation, so in order to effectively assess upward mobility, the effect of inflation to time has been eliminated. It can be clearly observed from Figure 1 that median income of people increased over time by reaching more than $100,000 for Asians. Also, Asians as immigrants (at least first generation of Asians was immigrants) presented the highest median real income, which can determine that by hard work even people from lower class (if we consider immigrants as lower class than local established people) can achieve wealth (which is a main concept of upward mobility). Table 1 showed the slope of the lines for each race, which established the median real income increase between 2000-2021. The results are consistent with the graph that shows people attained higher income over time. It has to be noted that working population of U.S (approximately 131,202 people for 2021) was used to obtain median income value for each year and for each race.

```{r, figure1, echo=FALSE, message=FALSE,warning=FALSE,fig.cap="Real median household income over time for different races"}
income = fread('tableA2.csv') %>% 
  tibble 
df= income %>% 
  select(-Margin_of_error_for_median, -Margin_of_error_for_mean) %>% 
  na.omit() %>% 
  filter(!Races=='Blackd', !Races =='Asiand', !Races == 'Whited', !Races=='All races', !Races=='American Indian and Alaska native comb') %>% 
  filter(between(Year, 2000,2021))
ggplot(df, aes (Year, Median_income, color=Races)) +
         geom_line(linetype='dashed', size=1)+
         theme_bw() +
         labs(x = "Year", y = "Median income ($)", fill="Races") +
         scale_x_continuous(breaks=seq(1993,2021,by=4))+
         scale_fill_brewer(palette = "Set2")
```
```{r, figure2, echo=FALSE, message=FALSE,warning=FALSE,fig.cap="Real median household wealth over time for different races"}

combinedNetworthByRace <- read_excel("CombinedNetByRace.xlsx",
                                     col_names = TRUE, skip = 1)
colnames(combinedNetworthByRace) <- c("race_ethnicity","2000","2002","2004","2005","2009",
                                      "2010","2011","2013","2014","2015","2016", "2017",
                                      "2018","2019","2020")

combinedNetByRace_wide <- melt(combinedNetworthByRace, id='race_ethnicity')
colnames(combinedNetByRace_wide) <-c("race_ethnicity","year","networth")
combinedNetByRace_wide$race_ethnicity <-as.factor(combinedNetByRace_wide$race_ethnicity)
combinedNetByRace_wide$year <- as.Date(combinedNetByRace_wide$year,format="%Y")
suppressWarnings(combinedNetByRace_wide$networth <-as.numeric(combinedNetByRace_wide$networth, na.rm = TRUE))

wealthByRace_chart <- ggplot(combinedNetByRace_wide, aes(x = year, 
                                                          y = networth, 
                                                          group = race_ethnicity,
                                                          color = race_ethnicity )) + 
 geom_line() + labs(x = "Year", y = "Median Networth ($)", 
                     color = "Race/Ethnicity") + theme_minimal()+theme_bw()
wealthByRace_chart + scale_y_continuous(limit = c(0,250000),labels = scales::comma)
```
Wealth distribution varies across different races, and Asians tend to accumulate the most wealth in the United States. This can be attributed to various factors, such as their high levels of education, higher average income, and high percentage of investment. As a result, Asians have the highest median household wealth just over $200,000, as shown in Figure 2. Meanwhile, other races such as Black and Hispanic households have lower median household wealth. Nonetheless, it is important to note that wealth and income while highly correlated, many other factors such as education, and age impact one's overall wealth. 

```{r, figure3, echo=FALSE, message=FALSE,warning=FALSE,fig.cap="Real median household wealth over time for different Education"}

combinedNetByEd <- read_excel("americandream/CombinedNetByEd.xlsx",col_names = TRUE, skip = 1)
colnames(combinedNetByEd) <- c("ed_house","2000","2002","2004","2005","2009","2010","2011","2013","2014","2015","2016","2017","2018","2019","2020")

combinedNetByEd_wide <- melt(combinedNetByEd, id='ed_house')
colnames(combinedNetByEd_wide) <-c("ed_house","year","networth")
combinedNetByEd_wide$ed_house <-as.factor(combinedNetByEd_wide$ed_house)
combinedNetByEd_wide$year <- as.Date(combinedNetByEd_wide$year,format="%Y")
suppressWarnings(combinedNetByEd_wide$networth <-as.numeric(combinedNetByEd_wide$networth, na.rm = TRUE))

wealthByEd_chart <- ggplot(combinedNetByEd_wide, aes(x = year, y = networth, group = ed_house, color = ed_house )) + 
  geom_line() + labs(x = "Year", y = "Median income ($)", color = "Education of Householder") + theme_bw()
wealthByEd_chart + scale_y_continuous(limits = c(0,450000),labels = scales::comma)
```
Another measures of upward mobility in a healthy economy is wealth, and education plays a crucial role in determining a person's wealth. Therefore, it is important to examine the relationship between education and wealth over time. Figure 3 displays the real median household netweorth of population groups with different education levels over time, with adjustments made for inflation to eliminate its effect on assessing upward mobility. The graph clearly illustrates that median household wealth increased over time, with the highly educated achieving the highest median real wealth. A Masters or professional degree had the highest median real wealth, suggesting that hard work can lead to wealth, which is a critical component of upward mobility. 

```{r, table1, echo=FALSE, message=FALSE, warning=FALSE}
year93 = df %>% 
  select(Year, Median_income, Races) %>% 
  filter(Year==2000) 
year21 = df %>% 
  select(Year, Median_income, Races) %>% 
  filter(Year==2021)
final = full_join(year93,year21, by = "Races" )
final %>% 
  mutate('Median income increase' = round ((Median_income.y - Median_income.x)/(2021-2000), digits=0)) %>% 
  select(Races,'Median income increase')  %>% 
  filter (!Races=='Mixed races') %>% 
  kable(align=rep('c', 3), format = "pandoc", booktabs = TRUE, caption = "Real median income increase between 2000-2021 (slope of the lines) for each race", escape = FALSE)
```

Real income of people differ in a certain range. Figure 2 represented percent distribution of household from different races having different range of annual income. The first message of the figures is that comparatively and generally, having small income as between $15,000 to $25,000 or $35,000 to $50,000 decreased over time, which can indicate percent distribution of people who are earning more increased. That can be observed from the income range $150,000 to $200,000 and over $200,000. More than 20% of Asians' annual income is more than $200,000. The sharp increase in number of people who earn more than $200,000 can be noticed after 2013 for all races. Again, that can prove the concept of upward mobility. 

```{r, figure4, echo=FALSE, message=FALSE, warning = FALSE, fig.cap="Percent distribution of real income between certain ranges for different races over time"}
dfl = pivot_longer(df, cols = c('15,000_to_24,999' , '35,000_to_49,999', '150,000_to_199,999',  '200,000_and_over'))
dfl$name= as.factor(dfl$name)
ggplot(dfl, aes (Year, value, color=Races)) +
         facet_wrap(~factor(name, levels = c('15,000_to_24,999', '35,000_to_49,999', '150,000_to_199,999', '200,000_and_over')))+
         geom_line(size=1)+
         theme_bw() +
         scale_x_continuous(breaks=seq(1993,2021,by=4))+
         labs(x = "Year", y = "Percent distribution", fill="Races") 
```


Since homeownership is a key factor in establishing upward or downward mobility of Americans, Figure 3 represented homeownership rate over time. The housing bubble was a period of rapid growth in the housing market in the early 2000s, fueled by low interest rates and lax lending standards. However, it ultimately led to a crash in 2008, resulting in the foreclosure of millions of homes and a nationwide economic crisis. That trend was followed by The Foreclosure Crisis (2007-2012). The foreclosure crisis was a result of the housing bubble bursting, which led to a high number of foreclosures and a decline in home values. It resulted in many families losing their homes, and the government had to intervene with programs such as the Home Affordable Modification Program (HAMP) and the Home Affordable Refinance Program (HARP). We can observe a grow in homeownership rate after 2015, which did not last long because of the COVID. The COVID-19 pandemic caused a significant economic downturn, resulting in job losses and financial hardship for many households. It also led to a moratorium on evictions and foreclosures to prevent further economic instability. Although a gradual increase in homeownership rate can be observed after 2021, it cannot explicitly prove upward mobility or downward mobility of the population. The homeownership rate can significantly be affected by several factors as mentioned above and plus the price of the houses which considerably increased over time due to economic crisis. The comprehensive demonstration of that tendency was provided in Figure 4. 

```{r, figure5, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Homeownership rate in the United States from 1993 to 2022"}
home = read.csv('home.csv')
home$DATE = strptime(as.character(home$DATE), "%m/%d/%Y") %>% 
  as.Date((home$DATE), format = "%d-%m-%y")
home %>% 
  filter(DATE>'1999-07-01') %>% 
  ggplot(aes (DATE, Percent)) +
         geom_line(size=1)+
         theme_bw() +
         labs(x = "Year", y = "Homeownership rate") +
         scale_x_date(date_breaks = "36 months", date_labels = "%Y")+
         scale_fill_brewer(palette = "Set2")
```


```{r, figure6, echo=FALSE, message=FALSE, fig.cap="Average sales price of houses sold for the United States"}
home_price = read.csv('home_price.csv')
home_price$Date = strptime(as.character(home_price$Date), "%m/%d/%Y") %>% 
  as.Date((home_price$Date), format = "%d-%m-%y")
home_price %>% 
  filter(Date>'1999-10-01') %>% 
  ggplot(aes (Date, Price)) +
         geom_line(size=1)+
         theme_bw() +
         labs(x = "Year", y = "Sales price of houses ($)") +
         scale_x_date(date_breaks = "36 months", date_labels = "%Y")+
         scale_fill_brewer(palette = "Set2")
```

Looking into more data and research done by economists, per capita personal income  comes as an important measure to consider while evaluating wealth. Personal income is defined as an income that people get from wages and salaries, Social Security and other government benefits, dividends and interest, business ownership, and other sources. 
Per capita personal income is total personal income divided by total midyear population. This measure has been tracked in the Census Bureau decennial counts for 2010 and 2020 to create consistent time series that are used to prepare per capita personal income statistics. 
As shown in Figure 5 below, americans per capita personal income has doubled over the last two decades. As expected, states in the Mid-Atlantic, Northeast, and Hawaii are among states with highest per capita personal income. 


```{r, figure7, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Per capita personal in the United States from 2000 to 2021"}
df <- fread('dream.csv')
df2 <- melt(df, id = c("GeoFips", "State")) %>%
rename("state" = "State")
year2000 <- df2 %>%
  filter(variable == 2000)
year2010 <- df2 %>%
  filter(variable == 2010)
year2021 <- df2 %>%
  filter(variable == 2021)
p2 <- plot_usmap(data = year2000, values = "value", labels=FALSE)
p3 <- plot_usmap(data = year2010, values = "value", labels=FALSE)
p4 <- plot_usmap(data = year2021, values = "value", labels=FALSE)

p6 <- plot_usmap(data = year2000, values = "value", labels=FALSE) +
  scale_fill_continuous(low = "white", high = "red", 
                         name = "income", 
                        limits = c(1000,100000)) +
  easy_move_legend(to = c("right")) +
  labs(title = "2000") +
  theme(panel.background = element_rect(colour = "black"))

p7 <- plot_usmap(data = year2010, values = "value", labels=FALSE) +
  scale_fill_continuous(low = "white", high = "red", 
                         name = "income", 
                        limits = c(1000, 100000)) +
  easy_move_legend(to = c("right")) +
  labs(title = "2010") +
  theme(panel.background = element_rect(colour = "black"))

p8 <- plot_usmap(data = year2021, values = "value", labels=FALSE) +
  scale_fill_continuous(low = "white", high = "red", 
                         name = "income", 
                        limits = c(1000,100000)) +
  easy_move_legend(to = c("right")) +
  labs(title = "2021") +
  theme(panel.background = element_rect(colour = "black"))
p10 <- p6 + p7 + p8
p10
```

Figure 8 below shows how extreme wealth is highly concentrated geographically. Nearly a third of nationwide wealth is held by families living in New York and California. Another 18 percent belongs to residents of Texas and Florida. In sum, this means that more than half of nationwide extreme wealth is held by the residents of just four states. These states are home to less than half (46 percent) of the U.S. population.

```{r, Figure8, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Wealth Estimates from across the United States in 2022"}
wea = fread('share_wealth_us.csv')
weaplot <- ggplot(data = wea, aes(x = reorder(State, SNW), y = SNW, fill = State)) + 
   geom_bar(stat = "identity") + 
   coord_flip()+
   labs(x = "State", y = "Share of Nationwide Wealth (%)", 
    bottom = textGrob("grid caption", x = 1, 
                                hjust = 1, gp = gpar(fontface = 3L, fontsize = 9)))  +
  theme(legend.position = "none") 
weaplot

```
Assets by wealth percentile group distribution shows a higher interest for real state from the bottom 50% of the population compared to the top 0.1% that has corporate equities and mutual fund shares as main asset. Extremely wealthy households have a total different composition of wealth by asset type compared to households in the bottom percentile. 

```{r, Figure9, echo=FALSE, message=FALSE, fig.cap="Assets by wealth percentile group in 2022"}
compo = fread('components.csv')
compo <- rename(compo, Top1 = `Top 0.1%`, Top2 = `99-99.9%`, Top3 = `90-99%`, middle = `50-90%`, bottom50 = `Bottom 50%`)
compomelt <- pivot_longer(compo, c("Top1", "Top2", "Top3", "middle", "bottom50"))
compomelt <- rename(compomelt, "percentile_group" = "name", "percent" = "value")
compomelt2 <- compomelt
compomelt2$percentile_group <- factor(compomelt2$percentile_group, levels = c("Top1", "Top2", "Top3", "middle", "bottom50"))
ggplot(data = compomelt2, aes(x = percentile_group, y = percent, fill = `Wealth component`)) +
  geom_bar(stat = "identity") +
  labs(caption = "Top1 =Top 0.1%, Top2 =99-99.9%, Top3 =90-99%, middle =50-90%, bottom50 =Bottom 50%") 
```

```{r, figure10, echo=FALSE, message=FALSE,warning=FALSE,fig.cap="Real median household wealth over time for different ages"}
combinedNetByAge <- read_excel("./americandream/CombinedNetByAge.xlsx",col_names = TRUE, skip = 2)
colnames(combinedNetByAge) <- c("age_house","2000","2002","2004","2005","2009","2010","2011","2013","2014","2015","2016","2017","2018","2019","2020")

combinedNetByAge_wide <- melt(combinedNetByAge, id='age_house')
colnames(combinedNetByAge_wide) <-c("age_house","year","networth")
combinedNetByAge_wide$age_house <-as.factor(combinedNetByAge_wide$age_house)
combinedNetByAge_wide$year <- as.Date(combinedNetByAge_wide$year,format="%Y")
suppressWarnings(combinedNetByAge_wide$networth <-as.numeric(combinedNetByAge_wide$networth, na.rm = TRUE))


wealthByAge_chart <- ggplot(combinedNetByAge_wide, aes(x = year, 
                                                       y = networth, 
                                                       group = age_house,
                                                       color = age_house )) + 
  geom_line() + labs(x = "Year", y = "Median Networth", 
                     color = "Age of Householder") + theme_bw()
wealthByAge_chart + scale_y_continuous(limits = c(0,350000), labels = scales::comma)
```



```{r, figure11, echo=FALSE, message=FALSE, fig.cap="Real Median Income, US"}
real_median_income <- fread('americandream/MEHOINUSA672N.csv')
median_income <- fread('americandream/MEFAINUSA646N.csv')
income_lowest_50 <- fread('americandream/WFRBLB50107.csv')
income_share <- fread('americandream/dfa-networth-shares.csv')
income_share$Date <- as.yearqtr(income_share$Date, format = "%Y:Q%q")
income_share <- income_share %>% mutate(Category = ifelse(Category == "TopPt1" | Category == "RemainingTop1", "Top1", Category))
income_share <- income_share %>% filter(Date > "1999-01-01")

# Create a new column with renamed categories
income_share$Category <- ifelse(income_share$Category == "Top1", "Top 1%",
                                               ifelse(income_share$Category == "Next9", "Next 9%", 
                                                      ifelse(income_share$Category == "Next40", "Next 40%", 
                                                             ifelse(income_share$Category == "Bottom50", "Bottom 50%", 
                                                                    income_share$Category))))
```

```{r, figure12, echo=FALSE, message=FALSE, fig.cap="Median Income, US"}
median_income$DATE <- as.Date(median_income$DATE)
median_income <- median_income %>% filter(DATE > "1999-01-01")
ggplot(data = median_income, aes(x=DATE, y=MEFAINUSA646N)) + 
  geom_line(color = "Dark Green") +
  labs(x = 'Year', y = 'Median Income') +
  theme_minimal()
```

Since 2000, median income growth has been substantial, nearly doubling from ~$50,000 to ~$90,000, with only a slight hiccup as a result of the Global Financial Crisis, [figure 12] before quickly picking up speed again. Similarly, there is a discernable dip as a result of the COVID-19 pandemic, before economic growth (and inflation) rapidly picked up. Overall, however, Americans have experiences long term secular income growth since 2000. 

```{r, figure13, echo=FALSE, message=FALSE, fig.cap="Real Median Income, US"}
real_median_income$DATE <- as.Date(real_median_income$DATE)
real_median_income <- real_median_income %>% filter(DATE > "1999-01-01")
ggplot(data = real_median_income, aes(x=DATE, y=MEHOINUSA672N)) + 
  geom_line(color = "Dark Green") +
  labs(x = 'Year', y = 'Real Median Income') +
  theme_minimal()
```

While median income over time is in fact a useful and interesting metric, it is also the case that inflation can distort what real world income changes look like. By adjusting for inflation [figure 13] as defined in the US consumer price index, the data set gives a better idea of how wages are changing relative to cost of living. Since 2000, we see the impacts of the Global Financial Crisis in 2007-2008. Real wages took some time to recover in the wake of bank failures, mass unemployment, and a deflationary environment, with wages failing to recover until 2015. Since 2015/2016, however, real wages have increased rapidly, from roughly 65,000 to 72,000 circa 2000 US dollars, an increase of nearly 11%. Although beyond the scope of the data explored here, all of these gains have seen a strong negative impact on the heels of historically high CPI over the 2020-2023 period. The Federal Reserve continues to tighten monetary policy in order to attempt to slow inflation, although the long term affects are as yet unclear.

The significant finding though is that despite inflation and major economic pressures from the GFC and COVID-19, Americans have still seen substantial real income growth, indicating an improving quality of life and the ability to pursue the American dream.

```{r, figure14, echo=FALSE, message=FALSE, fig.cap="Share of Net Worth by Economic Class"}
income_share_summed1 <- aggregate(`Net worth` ~ Date + Category, data = income_share, sum)

# Create a ggplot object with Bottom50 net worth over time
ggplot(income_share_summed1, aes(x = Date, y = `Net worth`, color = Category, group = Category)) +
  geom_line() +
  labs(x = "Date", y = "Percentage") +
  theme_minimal()
```

Another important factor is how wealth is divided among the population [figure 14]. If we were to see net worth / assets etc divided extremely unevenly, it would be a sign that perhaps the majority of the population is not getting access to the same opportunities.

That is unfortunately what we see however, with the bottom 50% of the population holding less than 10% of the net worth share. Perhaps more optimistically, however, we do see that the 10th to 50th percentiles pull in over 30% of net worth, although this trend is decreasing ever so slightly over time. While the 30% is less than their representation in the population, it does indicate that reaching upper middle class levels is strongly correlated to success and achieving the American Dream. Despite that, it is clear that work needs to be done to consider how we can best encourage the economic fortunes of the bottom 50%.

We see a similar pattern when it comes to Asset distribution [figure 17], with the top 10% holding a severely disproportionate share of total assets. More encouraging, however, we see that the top 40% and bottom 50% hold a significant portion of home mortgages [figure 16], indicating that many are still able to mortgage a home and achieve that ever so important element of the American Dream. 

Lastly, we see that lower and middle classes hold the lion share of consumer credit [figure 15. This points to some problems, as consumer credit often arises as a result of cash shortages. So lower classes may be achieving certain elements of the American Dream, although they are likely shackling themselves with debt that, long term, may be keeping them from advancing as far as they otherwise could.


```{r, figure15, echo=FALSE, message=FALSE, fig.cap="Share of Consumer Credit by Economic Class"}
income_share_summed2 <- aggregate(`Consumer credit` ~ Date + Category, data = income_share, sum)
# Create a ggplot object with Bottom50 net worth over time
ggplot(income_share_summed2, aes(x = Date, y = `Consumer credit`, color = Category, group = Category)) +
  geom_line() +
  labs(x = "Date", y = "Percentage") +
  theme_minimal()
```

```{r, figure16, echo=FALSE, message=FALSE, fig.cap="Share of Mortgages by Economic Class"}
income_share_summed3 <- aggregate(`Home mortgages` ~ Date + Category, data = income_share, sum)
# Create a ggplot object with Bottom50 net worth over time
ggplot(income_share_summed3, aes(x = Date, y = `Home mortgages`, color = Category, group = Category)) +
  geom_line() +
  labs(x = "Date", y = "Percentage") +
  theme_minimal()
```

```{r, figure17, echo=FALSE, message=FALSE, fig.cap="Share of Assets by Economic Class"}
income_share_summed4 <- aggregate(Assets ~ Date + Category, data = income_share, sum)
# Create a ggplot object with Bottom50 net worth over time
ggplot(income_share_summed4, aes(x = Date, y = Assets, color = Category, group = Category)) +
  geom_line() +
  labs(x = "Date", y = "Percentage of all Net Worth in US") +
  theme_minimal()
```
One of the ways we can measure if people are still seeking the the American Dream is to look at the number of immigrants entering the United States. Using a line graph to visualize the number people who migrated to the United State from 2000 to 2021, as seen in Figure 18, we notice a decline of steady decline since 2019.
```{r, figure18, echo=FALSE, message=FALSE,warning=FALSE,fig.cap="Immigration into the United States (Numbers in thousand)"}
immigrations <-read.csv("hst_mig_a_2_ReOrganized.csv", header = TRUE)
immigrantsDF <-  rename(immigrations, Region = TypeOfMigration) %>%
                na.omit()
ggplot(immigrantsDF, 
        aes(x = MobilityPeriod, y = MoversFromAbroad, color = Region, group = Region)) +
    geom_line() +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
    labs(x="Mobility Periods", y = "Immigrants")
```


Using a box plot graph to visualize the number people who migrated to the United State from 2000 to 2021, we show the median for each region for each the years as shown in Figure 19.  We also see a decreasing trend since 2019.
```{r, figure19, echo=FALSE, message=FALSE,warning=FALSE,fig.cap="Immigration into the United States (Numbers in thousand)"}
ggplot(data=immigrantsDF, aes(x=MobilityPeriod, y=MoversFromAbroad)) +
        geom_point(aes(color=Region), alpha=0.2, position="jitter") +
        geom_boxplot(outlier.size=0, alpha=0.1) +
        theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
        theme(legend.position="right") +
        labs(x="Mobility Periods", y = "Immigrants")
```

Using a bar chart to visualize the immigration data, we see the total number of immigrants entering the United States for each region from 2000 through 2021 in Figure 20.
```{r, figure20, echo=FALSE, message=FALSE,warning=FALSE,fig.cap="Total Immigration (in thousands) from 2000 to 2021"}
ggplot(immigrantsDF,aes(MoversFromAbroad,Region), label=Region)+
  geom_bar(stat="identity", col="lightblue")+
  labs(x="Immigrants", y = "Region")+
  coord_flip()
```


To help explain the downward trend of immigration, we decided to look at the number of U.S visas issued to foreigners. Just as we suspected, as seen in Figure 21, our visualization of the visas dataset confirms a correlation between the number of visas issued and the number of immigrants entering the United States.
```{r, figure21, echo=FALSE, message=FALSE,warning=FALSE,fig.cap="Visas Issued by the United States from 2000 to 2021 (Number in thousands)"}
visa <-read.csv("visas_granted_usafacts.csv", header = FALSE)
visa <- visa[1:2,] # grab only the first 2 rows
transposedVisa <- t(visa) %>%
                na.omit() 
rownames(transposedVisa)<-NULL #remove row names
colnames(transposedVisa) = transposedVisa[1,] # copy first row to header
transposedVisa <- transposedVisa[-1,] # delete the first row since it was converted to header
transposedVisa <- as.data.frame(transposedVisa)
i <- c(1, 2)  # columns to convert from string to number and trim white spaces
transposedVisa[ , i] <- sapply(transposedVisa[ , i], 
                                function(x) as.numeric(str_remove_all(x," ")))
transposedVisa <-  rename(transposedVisa, Visas = "Visas granted (People)") %>%
                na.omit()
visaDF <- transposedVisa %>%
        na.omit() %>%
        filter(Years >= 2000) %>%
        mutate(Visas = Visas/1000)
ggplot(visaDF, aes(Years, Visas)) +
      geom_line(lwd=1) +
      theme_bw() +
      labs(x="Years", y = "Visas")
```


To further explain the downward trend of immigration, we decided to look at the number of asylum claims the U.S granted to foreigners. Just as we suspected, as shown in Figure 22, our visualization of the asylums dataset confirms a correlation between the number of asylums claims granted and the number of immigrants entering the United States.
```{r, figure22, echo=FALSE, message=FALSE,warning=FALSE, fig.cap="Asylums Granted by the United States from 2000 to 2021 (Number in thousands)"}
asylum <-read.csv("asylum_claims_granted_usafacts.csv", header = FALSE)
asylum <- asylum[1:2,] # grab only the first 2 rows
transposedAsylums <- t(asylum) %>%
                na.omit() 
rownames(transposedAsylums)<-NULL #remove row names
colnames(transposedAsylums) = transposedAsylums[1,] # copy first row to header
transposedAsylums <- transposedAsylums[-1,] # delete the first row since it was converted to header
transposedAsylums <- as.data.frame(transposedAsylums)
i <- c(1, 2)  # columns to convert from string to number and trim white spaces
transposedAsylums[ , i] <- sapply(transposedAsylums[ , i], 
                                function(x) as.numeric(str_remove_all(x," ")))
transposedAsylums <-  rename(transposedAsylums, Asylums = "Asylum claims granted (People)") %>%
                              na.omit()
asylumDF <- transposedAsylums %>%
        na.omit() %>%
        filter(Years >= 2000) %>%
        mutate(Asylums = Asylums/1000)
ggplot(asylumDF, aes(Years, Asylums)) +
      geom_line(lwd=1) +
      theme_bw() +
      labs(x="Years", y = "Asylums")
```



\section{Future Work}
In a scope of this project, an interactive dashboard tool will be created to obtain answers to all our research questions. We will use R programming language and R Studio platform to materialize this dashboard. The dashboard will be hosted at Shinyapps server for ease of public access. We will also look at income data utilizing a gif format.



\section{Updated timeline}
```{r, echo=FALSE, message=FALSE}
df=read.csv("Project.csv")
kable(df, align = "l")|>
 column_spec(1, width = "3cm")|>
 column_spec(2, width = "4cm")|>
 column_spec(3, width = "10cm")
```
\section{References}
[^1]: https://www2.census.gov/programs-surveys/demo/tables/wealth/2020/wealth-asset-ownership/Wealth_tables_dy2020.xlsx
[^2]: https://www.census.gov/topics/income-poverty/wealth/data/tables.All.List_2110684178.html#list-tab-List_2110684178
[^3]: https://www2.census.gov/programs-surveys/demo/tables/wealth/2020/wealth-asset-ownership/State_Wealth_tables_dy2020.xlsx
[^4]: 
https://www2.census.gov/programs-surveys/demo/tables/p60/276/tableA2.xlsx
[^5]: https://www2.census.gov/programs-surveys/demo/tables/geographic-mobility/time-series/historic/hst_mig_a_2.xlsx
[^6]: https://a.usafacts.org/api/v4/Metrics/csv/25906?&_ga=2.244264198.2048794940.1680399322-1530464110.1680399322&_gac=1.242036406.1680399340.EAIaIQobChMIhvewhoeK_gIVBWpvBB3bzgsgEAMYASAAEgJfGvD_BwE
[^7]: https://a.usafacts.org/api/v4/Metrics/csv/13021?&_ga=2.218415642.2048794940.1680399322-1530464110.1680399322&_gac=1.3868548.1680399340.EAIaIQobChMIhvewhoeK_gIVBWpvBB3bzgsgEAMYASAAEgJfGvD_BwE
[^8]: 
https://www.investopedia.com/terms/a/american-dream.asp
[^9]:
https://fred.stlouisfed.org/series/MEHOINUSA672N
[^10]: 
https://fred.stlouisfed.org/series/MEFAINUSA646N
[^11]: 
https://fred.stlouisfed.org/series/WFRBLB50107
